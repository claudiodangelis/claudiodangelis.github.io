<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      How I shutdown my Raspberry Pi &middot; Claudio d'Angelis Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Claudio d'Angelis Blog
        </a>
      </h1>
      <p class="lead">IT Consultant.<br/> Ad Tech, Unix, Progressive Rock.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

            
      <a class="sidebar-nav-item" href="/about.html">About</a>
          
      <a class="sidebar-nav-item" href="/archive.html">Archive</a>
                
    </nav>
    <div class="social-links">
      <p>
        <small>email</small>
        <a href='&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#99;&#108;&#97;&#117;&#100;&#105;&#111;&#100;&#97;&#110;&#103;&#101;&#108;&#105;&#115;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;'><em>(click)</em></a><br/>
        <small>github</small>
        <a href="https://github.com/claudiodangelis"> claudiodangelis</a><br/>
        <small>twitter</small>
        <a href="https://twitter.com/daw985">daw985</a><br/>
        <small>linkedin</small>
        <a href="https://linkedin.com/in/claudiodangelis">/in/claudiodangelis</a><br/>
        <small>archlinux</small> <a href="https://aur.archlinux.org/packages/?SeB=m&K=claudiodangelis"> AUR packages</a>
        <br/><a href="/feed.xml">RSS feed</a>

      </p>
    </div>
    <small>
      &copy; 2018. All rights reserved.<br/>
      P.IVA/VAT ID 02856420597
    </small>
  </div>
</div>


    <div class="content container">
      <p>I have a Raspberry Pi board and some days ago I decided to use it as a sort of print server at home, excited about the idea of being able to plug the RasPi’s power supply then turn the printer on and wirelessly send it documents from my laptop(s).<br />
While getting ready to put my hands on it and set up the server, a problem showed up:
once the print is done, I’d probably want to turn off the printer, turn off the RasPi and possibly unplug power supply; it’s a <em>headless</em> system, so I would connect over SSH and run the proper command to shutdown the RasPi, but what about my mother?</p>

<p>I mean, she’s clearly not a UNIX geek.
Without a power button or a point-and-click graphical interface she wouldn’t be able to properly shutdown the RasPi, so she would probably <strong>unplug the power supply</strong>, and we all know how bad is this practice.</p>

<!--more-->

<p>I had to find a way to communicate with the Raspberry Pi from the <em>real, physycal, tangible,</em> world.</p>

<p>I know that for 15$ one can have a USB power button, but that  just didn’t  sound like the kind of solution I was looking for.</p>

<p>After some thinking I figured it out: <a href="http://linux.die.net/man/8/udev">udev</a>.<br />
From Wikipedia:</p>

<blockquote>
  <p><strong>udev</strong> is a device manager for the Linux kernel. Primarily, it manages device nodes in /dev.</p>
</blockquote>

<p>Basically, among other features, you can use <em>udev</em> to <strong>get informations</strong> about a device when an action is performed (<em>add, remove, change, online, offline</em>).</p>

<p>That said, here comes the idea: I choose a specific USB device and when a “remove” action is performed on that device RasPi shuts itself down. It fits pretty well as a solution for that <em>real world interaction</em> problem.</p>

<p>So, I wrote this simple python tool (very cool name: <strong>unplug2shutdown</strong>) that basically:</p>

<ul>
  <li><strong>Asks</strong> you to plug in the device you want to use as a shutdown handler</li>
  <li><strong>Waits</strong> for that device to be removed and then <strong>run</strong> <code class="highlighter-rouge">shutdown -h now</code></li>
</ul>

<p>Pretty simple. And it works with any kind of USB device as well: a flash/external drive, a SD/MMC adapter (even with no card in it), a WiFi adapter, a <strong>printer</strong>, and so on.</p>

<p>Coming back to my print server scenario, I have set the printer itself as a shutdown handler, so when I physycally turn it off, I have just to wait until RasPi’s green lights go out and then I can safely unplug power supply.<br />
If I chose a WiFi adapter, I would just unplug it then plug it in back to send the shutdown signal.</p>

<p>Needless to say, it’s a super quick and dirt tool by now, there may be a zillion edge cases for which it does not work.</p>

<p>You can download it at github: <a href="https://github.com/claudiodangelis/unplug2shutdown/archive/master.zip">zip archive</a>, or clone the git repository: <code class="highlighter-rouge">git clone git://github.com/claudiodangelis/unplug2shutdown.git</code></p>

<p>Dependencies:</p>

<ul>
  <li>GObject python bindings;</li>
  <li>GUdev python bindings;</li>
</ul>

<p><strong>Debian and derivatives</strong></p>

<p>sudo apt-get install python-gobject python-gudev</p>

<p>About the installation, since the tool is at a <strong>very early stage</strong>, there’s no installer yet so here’s the deal:</p>

<ol>
  <li>
    <p>run <strong>as root</strong>:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> /path/to/unplug2shutdown.py --configure
</code></pre></div>    </div>
  </li>
  <li>follow the instructions, you’ll need to plug the device that you want to use as a shutdown handler;</li>
  <li>
    <p>run the tool as root somehow at startup:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/path/to/unplug2shutdown.py &amp;
</code></pre></div>    </div>
  </li>
  <li>unplug the device and look at the magic;</li>
</ol>

<p>If you want to reconfigure it, you have to run <code class="highlighter-rouge">./unplug2shutdown.py --configure</code> again.</p>

<p>Here’s the repository on GitHub, <a href="https://github.com/claudiodangelis/unplug2shutdown">unplug2shutdown</a>, I’d really like to read your feedback about it, thanks.</p>

<p><strong>EDIT</strong>: Discuss it on <a href="https://plus.google.com/115859961800127275872/posts/FBq9Vx8y2hq">Raspberry Pi Google+  Community</a></p>

    </div>

  </body>
</html>
