<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>How I shutdown my Raspberry Pi | Claudio d’Angelis Blog</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="How I shutdown my Raspberry Pi" />
<meta property="og:locale" content="en" />
<meta name="description" content="I have a Raspberry Pi board and some days ago I decided to use it as a sort of print server at home, excited about the idea of being able to plug the RasPi’s power supply then turn the printer on and wirelessly send it documents from my laptop(s). While getting ready to put my hands on it and set up the server, a problem showed up: once the print is done, I’d probably want to turn off the printer, turn off the RasPi and possibly unplug power supply; it’s a headless system, so I would connect over SSH and run the proper command to shutdown the RasPi, but what about my mother?" />
<meta property="og:description" content="I have a Raspberry Pi board and some days ago I decided to use it as a sort of print server at home, excited about the idea of being able to plug the RasPi’s power supply then turn the printer on and wirelessly send it documents from my laptop(s). While getting ready to put my hands on it and set up the server, a problem showed up: once the print is done, I’d probably want to turn off the printer, turn off the RasPi and possibly unplug power supply; it’s a headless system, so I would connect over SSH and run the proper command to shutdown the RasPi, but what about my mother?" />
<link rel="canonical" href="http://localhost:4000/linux/2013/05/01/how-i-shutdown-my-raspberrypi.html" />
<meta property="og:url" content="http://localhost:4000/linux/2013/05/01/how-i-shutdown-my-raspberrypi.html" />
<meta property="og:site_name" content="Claudio d’Angelis Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-05-01T00:00:00+02:00" />
<script type="application/ld+json">
{"dateModified":"2013-05-01T00:00:00+02:00","datePublished":"2013-05-01T00:00:00+02:00","@type":"BlogPosting","headline":"How I shutdown my Raspberry Pi","url":"http://localhost:4000/linux/2013/05/01/how-i-shutdown-my-raspberrypi.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/linux/2013/05/01/how-i-shutdown-my-raspberrypi.html"},"description":"I have a Raspberry Pi board and some days ago I decided to use it as a sort of print server at home, excited about the idea of being able to plug the RasPi’s power supply then turn the printer on and wirelessly send it documents from my laptop(s). While getting ready to put my hands on it and set up the server, a problem showed up: once the print is done, I’d probably want to turn off the printer, turn off the RasPi and possibly unplug power supply; it’s a headless system, so I would connect over SSH and run the proper command to shutdown the RasPi, but what about my mother?","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="alternate" type="application/rss+xml" title="Claudio d&#39;Angelis Blog" href="/feed.xml">
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/">Claudio d&#39;Angelis Blog</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <p>I have a Raspberry Pi board and some days ago I decided to use it as a sort of print server at home, excited about the idea of being able to plug the RasPi’s power supply then turn the printer on and wirelessly send it documents from my laptop(s).<br />
While getting ready to put my hands on it and set up the server, a problem showed up:
once the print is done, I’d probably want to turn off the printer, turn off the RasPi and possibly unplug power supply; it’s a <em>headless</em> system, so I would connect over SSH and run the proper command to shutdown the RasPi, but what about my mother?</p>

<p>I mean, she’s clearly not a UNIX geek.
Without a power button or a point-and-click graphical interface she wouldn’t be able to properly shutdown the RasPi, so she would probably <strong>unplug the power supply</strong>, and we all know how bad is this practice.</p>

<!--more-->

<p>I had to find a way to communicate with the Raspberry Pi from the <em>real, physycal, tangible,</em> world.</p>

<p>I know that for 15$ one can have a USB power button, but that  just didn’t  sound like the kind of solution I was looking for.</p>

<p>After some thinking I figured it out: <a href="http://linux.die.net/man/8/udev">udev</a>.<br />
From Wikipedia:</p>

<blockquote>
  <p><strong>udev</strong> is a device manager for the Linux kernel. Primarily, it manages device nodes in /dev.</p>
</blockquote>

<p>Basically, among other features, you can use <em>udev</em> to <strong>get informations</strong> about a device when an action is performed (<em>add, remove, change, online, offline</em>).</p>

<p>That said, here comes the idea: I choose a specific USB device and when a “remove” action is performed on that device RasPi shuts itself down. It fits pretty well as a solution for that <em>real world interaction</em> problem.</p>

<p>So, I wrote this simple python tool (very cool name: <strong>unplug2shutdown</strong>) that basically:</p>

<ul>
  <li><strong>Asks</strong> you to plug in the device you want to use as a shutdown handler</li>
  <li><strong>Waits</strong> for that device to be removed and then <strong>run</strong> <code class="highlighter-rouge">shutdown -h now</code></li>
</ul>

<p>Pretty simple. And it works with any kind of USB device as well: a flash/external drive, a SD/MMC adapter (even with no card in it), a WiFi adapter, a <strong>printer</strong>, and so on.</p>

<p>Coming back to my print server scenario, I have set the printer itself as a shutdown handler, so when I physycally turn it off, I have just to wait until RasPi’s green lights go out and then I can safely unplug power supply.<br />
If I chose a WiFi adapter, I would just unplug it then plug it in back to send the shutdown signal.</p>

<p>Needless to say, it’s a super quick and dirt tool by now, there may be a zillion edge cases for which it does not work.</p>

<p>You can download it at github: <a href="https://github.com/claudiodangelis/unplug2shutdown/archive/master.zip">zip archive</a>, or clone the git repository: <code class="highlighter-rouge">git clone git://github.com/claudiodangelis/unplug2shutdown.git</code></p>

<p>Dependencies:</p>

<ul>
  <li>GObject python bindings;</li>
  <li>GUdev python bindings;</li>
</ul>

<p><strong>Debian and derivatives</strong></p>

<p>sudo apt-get install python-gobject python-gudev</p>

<p>About the installation, since the tool is at a <strong>very early stage</strong>, there’s no installer yet so here’s the deal:</p>

<ol>
  <li>
    <p>run <strong>as root</strong>:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> /path/to/unplug2shutdown.py --configure
</code></pre></div>    </div>
  </li>
  <li>follow the instructions, you’ll need to plug the device that you want to use as a shutdown handler;</li>
  <li>
    <p>run the tool as root somehow at startup:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/path/to/unplug2shutdown.py &amp;
</code></pre></div>    </div>
  </li>
  <li>unplug the device and look at the magic;</li>
</ol>

<p>If you want to reconfigure it, you have to run <code class="highlighter-rouge">./unplug2shutdown.py --configure</code> again.</p>

<p>Here’s the repository on GitHub, <a href="https://github.com/claudiodangelis/unplug2shutdown">unplug2shutdown</a>, I’d really like to read your feedback about it, thanks.</p>

<p><strong>EDIT</strong>: Discuss it on <a href="https://plus.google.com/115859961800127275872/posts/FBq9Vx8y2hq">Raspberry Pi Google+  Community</a></p>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Claudio d&#39;Angelis Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              Claudio d&#39;Angelis Blog
            
            </li>
            
            <li><a class="u-email" href="mailto:claudiodangelis@gmail.com">claudiodangelis@gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/claudiodangelis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">claudiodangelis</span></a></li>
  
  
  
  <li><a href="https://www.twitter.com/daw985"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">daw985</span></a></li>
  
  
  
</ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>Personal blog of Claudio d&#39;Angelis.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
